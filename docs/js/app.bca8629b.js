(function(e){function t(t){for(var n,o,c=t[0],s=t[1],u=t[2],d=0,p=[];d<c.length;d++)o=c[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);l&&l(t);while(p.length)p.shift()();return i.push.apply(i,u||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,c=1;c<r.length;c++){var s=r[c];0!==a[s]&&(n=!1)}n&&(i.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},a={app:0},i=[];function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;i.push([1,"chunk-vendors"]),r()})({0:function(e,t){},1:function(e,t,r){e.exports=r("cd49")},4534:function(e,t,r){"use strict";r("fc60")},b383:function(e,t,r){},cd49:function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("7a23"),a=r("ecee"),i=r("c074"),o=r("ad3d"),c=(r("2b3d"),r("d3b7"),r("3ca3"),r("ddb0"),r("841c"),r("ac1f"),r("159b"),r("b64b"),Object(n["l"])({experimentName:"Unknown Experiment",prompt:"Use this page to record and upload your video",participantId:"",participantIdWasSet:!1,uploadName:"",uploadNameWasSet:!1})),s=c;function u(){var e=new URLSearchParams(window.location.search);Object.keys(s).forEach((function(t){var r=e.get(t);null!==r&&(s[t]=r)})),s.participantIdWasSet=null!==e.get("participantId"),s.uploadNameWasSet=null!==e.get("uploadName")}function l(e,t,r,a,i,o){var c=Object(n["n"])("UploadScreen");return Object(n["k"])(),Object(n["c"])(c)}var d={class:"section"},p={class:"container"},b=Object(n["e"])("h1",{class:"title"},"Video Upload",-1),m={class:"subtitle"},v={class:"field is-horizontal"},f=Object(n["e"])("div",{class:"field-label is-normal"},"Participant Id",-1),h={class:"field-body"},g={class:"field is-narrow"},j={class:"control"},O={class:"field is-horizontal"},w=Object(n["e"])("div",{class:"field-label is-normal"},"Upload Identifier",-1),R={class:"field-body"},k={class:"field is-narrow"},y={class:"control"},S={key:0},x={class:"field is-grouped is-grouped-centered"},E={class:"control pt-1"},U={class:"control"},W={key:1},B={class:"field is-grouped is-grouped-centered"},N={class:"control"},V={class:"control"},C={key:0,class:"notification"};function I(e,t,r,a,i,o){var c=Object(n["n"])("WebcamBox"),s=Object(n["n"])("FAIcon");return Object(n["k"])(),Object(n["c"])("section",d,[Object(n["e"])("div",p,[b,Object(n["e"])("h2",m,Object(n["o"])(e.experimentName),1),Object(n["e"])("div",v,[f,Object(n["e"])("div",h,[Object(n["e"])("div",g,[Object(n["e"])("div",j,[Object(n["r"])(Object(n["e"])("input",{type:"text",class:"input",disabled:e.dataStore.participantIdWasSet,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.dataStore.participantId=t})},null,8,["disabled"]),[[n["p"],e.dataStore.participantId]])])])])]),Object(n["e"])("div",O,[w,Object(n["e"])("div",R,[Object(n["e"])("div",k,[Object(n["e"])("div",y,[Object(n["r"])(Object(n["e"])("input",{type:"text",class:"input",disabled:e.dataStore.uploadNameWasSet,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.dataStore.uploadName=t})},null,8,["disabled"]),[[n["p"],e.dataStore.uploadName]])])])])]),Object(n["e"])("p",null,Object(n["o"])(e.prompt),1),"Record"===e.state?(Object(n["k"])(),Object(n["c"])("div",S,[Object(n["e"])(c),Object(n["r"])(Object(n["e"])("div",x,[Object(n["e"])("p",E,[Object(n["e"])("span",{class:["icon is-medium",{"has-text-danger":e.isRecording}]},[Object(n["e"])(s,{icon:"record-vinyl",size:"lg",pulse:""})],2)]),Object(n["e"])("p",U,[Object(n["e"])("button",{class:"button",onClick:t[3]||(t[3]=function(){return e.toggleRecording&&e.toggleRecording.apply(e,arguments)})},[Object(n["r"])(Object(n["e"])("span",null," Stop ",512),[[n["q"],e.isRecording]]),Object(n["r"])(Object(n["e"])("span",null," Record ",512),[[n["q"],!e.isRecording]])])])],512),[[n["q"],"running"===e.webcamStatus]])])):Object(n["d"])("",!0),"Review"===e.state?(Object(n["k"])(),Object(n["c"])("div",W,[Object(n["e"])("video",{class:"flipped",controls:"",src:e.recordedObjectUrl},null,8,["src"]),Object(n["e"])("div",B,[Object(n["e"])("p",N,[Object(n["e"])("button",{class:"button",disabled:e.isUploading,onClick:t[4]||(t[4]=function(t){return e.state="Record"})}," Rerecord ",8,["disabled"])]),Object(n["e"])("p",V,[Object(n["e"])("button",{class:["button is-primary",{"is-loading":e.isUploading}],disabled:e.isUploading,onClick:t[5]||(t[5]=function(){return e.uploadVideo&&e.uploadVideo.apply(e,arguments)})}," Upload Video ",10,["disabled"])])]),e.uploadError?(Object(n["k"])(),Object(n["c"])("div",C,Object(n["o"])(e.uploadError),1)):Object(n["d"])("",!0)])):Object(n["d"])("",!0)])])}var P=r("1da1"),L=(r("96cf"),r("99af"),r("d4ec")),M=r("bee2"),q=(r("6062"),r("a9ee")),A=r.n(q),F=function(){function e(){var t=this;Object(L["a"])(this,e),this.recorder=Object(n["m"])(null),this.mediaStream=Object(n["m"])(null),this.activeConnections=new Set,this.permissionState=Object(n["m"])("prompt"),this.isWebcamLoading=Object(n["m"])(!1),this.webcamError=Object(n["m"])(null),this.isRecording=Object(n["m"])(!1),this.webcamStatus=Object(n["a"])((function(){return t.mediaStream.value?"running":t.isWebcamLoading.value?"loading":"stopped"})),this.readPermissionStatus()}return Object(M["a"])(e,[{key:"readPermissionStatus",value:function(){var e=Object(P["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!navigator.permissions){e.next=10;break}return e.prev=1,e.next=4,navigator.permissions.query({name:"camera"});case 4:t=e.sent,this.permissionState.value=t.state,e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](1);case 10:case"end":return e.stop()}}),e,this,[[1,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"permissionStatus",value:function(){return this.permissionState}},{key:"startWebcam",value:function(){var e=Object(P["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.mediaStream.value&&!this.isWebcamLoading.value){e.next=2;break}return e.abrupt("return");case 2:if(this.isWebcamLoading.value=!0,e.prev=3,r={video:{facingMode:"user",width:1280,height:720,aspectRatio:1.777777778,frameRate:30},audio:!0},null!==(t=navigator.mediaDevices)&&void 0!==t&&t.getUserMedia){e.next=7;break}throw new Error("Browser doesn't support webcam");case 7:return e.next=9,navigator.mediaDevices.getUserMedia(r);case 9:this.mediaStream.value=e.sent,this.permissionState.value="granted";case 11:return e.prev=11,this.isWebcamLoading.value=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[3,,11,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"connectVideoElement",value:function(){var e=Object(P["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("granted"===this.permissionState.value){e.next=2;break}throw new Error("Doesn't have permissions yet!");case 2:this.activeConnections.add(t),console.log("Connecting media stream to video",this.mediaStream,t),t.srcObject=this.mediaStream.value,t.onloadedmetadata=function(){t.play()};case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"disconnectVideoElement",value:function(e){this.activeConnections.delete(e),e.srcObject=null,0!==this.activeConnections.size||this.recorder||this.stopWebcam()}},{key:"stopWebcam",value:function(){var e=Object(P["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.recorder){e.next=3;break}return e.next=3,this.stopRecording();case 3:this.mediaStream.value&&this.mediaStream.value.getTracks().forEach((function(e){return e.stop()})),this.mediaStream.value=null;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"startRecording",value:function(){var e=Object(P["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.recorder.value&&!this.isRecording.value){e.next=2;break}return e.abrupt("return");case 2:if(this.mediaStream.value){e.next=4;break}throw new Error("Webcam must be started before recording can happen");case 4:this.isRecording.value=!0,t=new A.a(this.mediaStream.value,{type:"video"}),t.startRecording(),this.recorder.value=t;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"stopRecording",value:function(){var e=Object(P["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(!t.recorder.value)throw new Error("Haven't started recording");t.isRecording.value=!1;var r=t.recorder.value;t.recorder.value.stopRecording((function(){e(r.getBlob()),t.recorder.value=null}))})));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearRecording",value:function(){var e=Object(P["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.recorder.value=null;case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),_=new F,D=_,T=r("6bd1"),z=new T["a"]("https://dartrobotlabstorage.blob.core.windows.net/study-video-uploads?sp=acw&st=2021-04-07T02:19:35Z&se=2022-04-07T10:19:35Z&sv=2020-02-10&sr=c&sig=9fpKagbOjUqAjHF579%2FW7KiM4U8YcBrbI8J70tH35Y4%3D"),H=function(){function e(){Object(L["a"])(this,e)}return Object(M["a"])(e,null,[{key:"upload",value:function(){var e=Object(P["a"])(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=z.getContainerClient("study-video-uploads"),a=n.getBlockBlobClient(r),e.next=4,a.uploadData(t);case 4:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}()}]),e}(),J={class:"is-relative webcam-box"},K={ref:"videoE",muted:""},Y={key:0,class:"is-overlay"},Z={class:"vcenter-parent"},G={key:0,class:"notification"};function Q(e,t,r,a,i,o){return Object(n["k"])(),Object(n["c"])("div",J,[Object(n["e"])("video",K,null,512),"running"!==e.webcamStatus?(Object(n["k"])(),Object(n["c"])("div",Y,[Object(n["e"])("div",Z,[null!==this.webcamStartError?(Object(n["k"])(),Object(n["c"])("div",G,Object(n["o"])(this.webcamStartError),1)):Object(n["d"])("",!0),Object(n["r"])(Object(n["e"])("button",{onClick:t[1]||(t[1]=function(){return e.startWebcam&&e.startWebcam.apply(e,arguments)}),class:["button is-primary",{"is-loading":"loading"===e.webcamStatus}]}," Start Webcam ",2),[[n["q"],"running"!==e.webcamStatus]])])])):Object(n["d"])("",!0)])}var X=Object(n["f"])({name:"WebcamBox",props:{enableRecordButton:{type:Boolean,default:!1}},setup:function(){var e=Object(n["m"])(null),t=Object(n["m"])(null);return Object(n["j"])((function(){if(!e.value)throw new Error("videoE is null");"running"===D.webcamStatus.value&&D.connectVideoElement(e.value)})),Object(n["i"])((function(){if(!e.value)throw new Error("videoE is null");D.disconnectVideoElement(e.value)})),{videoE:e,webcamStartError:t,webcamStatus:D.webcamStatus,isRecording:D.isRecording}},methods:{startWebcam:function(){var e=this;return Object(P["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.webcamStartError=null,t.prev=1,t.next=4,D.startWebcam();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](1),e.webcamStartError=t.t0;case 9:if(e.videoE){t.next=11;break}throw new Error("videoE is null");case 11:return t.next=13,D.connectVideoElement(e.videoE);case 13:case"end":return t.stop()}}),t,null,[[1,6]])})))()},playVideo:function(){if(!this.videoE)throw new Error("videoE is null");this.videoE.play()}}});r("4534");X.render=Q;var $=X,ee=Object(n["f"])({name:"UploadScreen",components:{WebcamBox:$},setup:function(){var e=Object(n["m"])("Record"),t=Object(n["m"])(null),r=Object(n["m"])(""),a=Object(n["m"])(!1),i=Object(n["m"])(null);return{state:e,experimentName:s.experimentName,prompt:s.prompt,dataStore:s,webcamStatus:D.webcamStatus,isRecording:D.isRecording,lastRecordedBlob:t,recordedObjectUrl:r,isUploading:a,uploadError:i}},methods:{toggleRecording:function(){var e=this;return Object(P["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(D.isRecording.value){t.next=4;break}D.startRecording(),t.next=9;break;case 4:return t.next=6,D.stopRecording();case 6:e.lastRecordedBlob=t.sent,e.recordedObjectUrl=URL.createObjectURL(e.lastRecordedBlob),e.state="Review";case 9:case"end":return t.stop()}}),t)})))()},discardRecordedVideo:function(){this.lastRecordedBlob=null,this.recordedObjectUrl="",this.uploadError=null,this.state="Record"},uploadVideo:function(){var e=this;return Object(P["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.lastRecordedBlob){t.next=2;break}return t.abrupt("return");case 2:if(!e.isUploading){t.next=4;break}return t.abrupt("return");case 4:return e.isUploading=!0,e.uploadError=null,r="".concat(s.experimentName,"-").concat(s.participantId,"-").concat(s.uploadName,".webm"),t.prev=7,t.next=10,H.upload(e.lastRecordedBlob,r);case 10:t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](7),console.error("Error uploading video",t.t0),e.uploadError=t.t0;case 16:null===e.uploadError&&(e.uploadError="Upload Successful"),e.isUploading=!1;case 18:case"end":return t.stop()}}),t,null,[[7,12]])})))()}}});ee.render=I;var te=ee,re=Object(n["f"])({name:"App",components:{UploadScreen:te}});re.render=l;var ne=re,ae=r("9483");Object(ae["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),a["c"].add(i["a"]),r("b383"),Object(n["b"])(ne).component("FAIcon",o["a"]).mount("#app"),Object(n["h"])(u)},fc60:function(e,t,r){}});
//# sourceMappingURL=app.bca8629b.js.map