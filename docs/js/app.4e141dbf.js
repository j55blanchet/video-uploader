(function(e){function t(t){for(var n,o,i=t[0],s=t[1],u=t[2],d=0,p=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);l&&l(t);while(p.length)p.shift()();return c.push.apply(c,u||[]),r()}function r(){for(var e,t=0;t<c.length;t++){for(var r=c[t],n=!0,i=1;i<r.length;i++){var s=r[i];0!==a[s]&&(n=!1)}n&&(c.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},a={app:0},c=[];function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=s;c.push([1,"chunk-vendors"]),r()})({0:function(e,t){},1:function(e,t,r){e.exports=r("cd49")},5791:function(e,t,r){},"707e":function(e,t,r){"use strict";r("714a")},"714a":function(e,t,r){},b383:function(e,t,r){},c118:function(e,t,r){"use strict";r("5791")},cd49:function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("7a23"),a=r("ecee"),c=r("c074"),o=r("ad3d"),i=(r("2b3d"),r("d3b7"),r("3ca3"),r("ddb0"),r("841c"),r("ac1f"),r("159b"),r("b64b"),Object(n["m"])({experimentName:"Unknown Experiment",prompt:"Use this page to record and upload your video",participantId:"",participantIdWasSet:!1,uploadName:"",uploadNameWasSet:!1})),s=i;function u(){var e=new URLSearchParams(window.location.search);Object.keys(s).forEach((function(t){var r=e.get(t);null!==r&&(s[t]=r)})),s.participantIdWasSet=null!==e.get("participantId"),s.uploadNameWasSet=null!==e.get("uploadName")}function l(e,t,r,a,c,o){var i=Object(n["o"])("UploadScreen");return Object(n["l"])(),Object(n["c"])(i)}var d={class:"section"},p={class:"container"},b=Object(n["f"])("h1",{class:"title"},"Video Upload",-1),f={class:"subtitle"},v={class:"field is-horizontal"},m=Object(n["f"])("div",{class:"field-label is-normal"},"Participant Id",-1),h={class:"field-body"},g={class:"field is-narrow"},O={class:"control"},j={class:"field is-horizontal"},w=Object(n["f"])("div",{class:"field-label is-normal"},"Upload Identifier",-1),S={class:"field-body"},R={class:"field is-narrow"},y={class:"control"},k=Object(n["f"])("strong",null,"Instructions:",-1),x={key:0},E={class:"field is-grouped is-grouped-centered"},U={class:"control"},W={class:"control"},B={key:1},P={class:"field is-grouped is-grouped-centered"},V={class:"control"},C={class:"control"},N={key:0,class:"notification"};function I(e,t,r,a,c,o){var i=Object(n["o"])("WebcamBox");return Object(n["l"])(),Object(n["c"])("section",d,[Object(n["f"])("div",p,[b,Object(n["f"])("h2",f,Object(n["p"])(e.dataStore.experimentName),1),Object(n["f"])("div",v,[m,Object(n["f"])("div",h,[Object(n["f"])("div",g,[Object(n["f"])("div",O,[Object(n["t"])(Object(n["f"])("input",{type:"text",class:"input",disabled:e.dataStore.participantIdWasSet,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.dataStore.participantId=t})},null,8,["disabled"]),[[n["q"],e.dataStore.participantId]])])])])]),Object(n["f"])("div",j,[w,Object(n["f"])("div",S,[Object(n["f"])("div",R,[Object(n["f"])("div",y,[Object(n["t"])(Object(n["f"])("input",{type:"text",class:"input",disabled:e.dataStore.uploadNameWasSet,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.dataStore.uploadName=t})},null,8,["disabled"]),[[n["q"],e.dataStore.uploadName]])])])])]),Object(n["f"])("p",null,[k,Object(n["e"])(" "+Object(n["p"])(e.dataStore.prompt),1)]),"Record"===e.state?(Object(n["l"])(),Object(n["c"])("div",x,[Object(n["f"])(i),Object(n["t"])(Object(n["f"])("div",E,[Object(n["f"])("p",U,[Object(n["f"])("span",{class:["record-icon",{"is-recording":e.isRecording}]},null,2)]),Object(n["f"])("p",W,[Object(n["f"])("button",{class:"button animate-width",onClick:t[3]||(t[3]=function(){return e.toggleRecording&&e.toggleRecording.apply(e,arguments)})},[Object(n["t"])(Object(n["f"])("span",null," Stop ",512),[[n["r"],e.isRecording]]),Object(n["t"])(Object(n["f"])("span",null," Record ",512),[[n["r"],!e.isRecording]])])])],512),[[n["r"],"running"===e.webcamStatus]])])):Object(n["d"])("",!0),"Review"===e.state?(Object(n["l"])(),Object(n["c"])("div",B,[Object(n["f"])("video",{class:"flipped",controls:"",src:e.recordedObjectUrl},null,8,["src"]),Object(n["f"])("div",P,[Object(n["f"])("p",V,[Object(n["f"])("button",{class:"button",disabled:e.isUploading,onClick:t[4]||(t[4]=function(){return e.rerecord&&e.rerecord.apply(e,arguments)})}," Rerecord ",8,["disabled"])]),Object(n["f"])("p",C,[Object(n["f"])("button",{class:["button is-primary",{"is-loading":e.isUploading}],disabled:e.isUploading,onClick:t[5]||(t[5]=function(){return e.uploadVideo&&e.uploadVideo.apply(e,arguments)})}," Upload Video ",10,["disabled"])])]),e.uploadError?(Object(n["l"])(),Object(n["c"])("div",N,Object(n["p"])(e.uploadError),1)):Object(n["d"])("",!0)])):Object(n["d"])("",!0)])])}var L=r("1da1"),D=(r("96cf"),r("99af"),r("d4ec")),M=r("bee2"),T=(r("6062"),r("a9ee")),A=r.n(T),_=function(){function e(){var t=this;Object(D["a"])(this,e),this.recorder=Object(n["n"])(null),this.mediaStream=Object(n["n"])(null),this.activeConnections=new Set,this.permissionState=Object(n["n"])("prompt"),this.isWebcamLoading=Object(n["n"])(!1),this.webcamError=Object(n["n"])(null),this.isRecording=Object(n["n"])(!1),this.webcamStatus=Object(n["a"])((function(){return t.mediaStream.value?"running":t.isWebcamLoading.value?"loading":"stopped"})),this.readPermissionStatus()}return Object(M["a"])(e,[{key:"readPermissionStatus",value:function(){var e=Object(L["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!navigator.permissions){e.next=10;break}return e.prev=1,e.next=4,navigator.permissions.query({name:"camera"});case 4:t=e.sent,this.permissionState.value=t.state,e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](1);case 10:case"end":return e.stop()}}),e,this,[[1,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"permissionStatus",value:function(){return this.permissionState}},{key:"startWebcam",value:function(){var e=Object(L["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.mediaStream.value&&!this.isWebcamLoading.value){e.next=2;break}return e.abrupt("return");case 2:if(this.isWebcamLoading.value=!0,e.prev=3,r={video:{facingMode:"user",width:1280,height:720,aspectRatio:1.777777778,frameRate:30},audio:!0},null!==(t=navigator.mediaDevices)&&void 0!==t&&t.getUserMedia){e.next=7;break}throw new Error("Browser doesn't support webcam");case 7:return e.next=9,navigator.mediaDevices.getUserMedia(r);case 9:this.mediaStream.value=e.sent,this.permissionState.value="granted";case 11:return e.prev=11,this.isWebcamLoading.value=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[3,,11,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"connectVideoElement",value:function(){var e=Object(L["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("granted"===this.permissionState.value){e.next=2;break}throw new Error("Doesn't have permissions yet!");case 2:this.activeConnections.add(t),console.log("Connecting media stream to video",this.mediaStream,t),t.srcObject=this.mediaStream.value,t.onloadedmetadata=function(){t.play()};case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"disconnectVideoElement",value:function(e){this.activeConnections.delete(e),e.srcObject=null,0!==this.activeConnections.size||this.recorder||this.stopWebcam()}},{key:"stopWebcam",value:function(){var e=Object(L["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.recorder){e.next=8;break}return e.prev=1,e.next=4,this.stopRecording();case 4:e.next=8;break;case 6:e.prev=6,e.t0=e["catch"](1);case 8:this.mediaStream.value&&this.mediaStream.value.getTracks().forEach((function(e){return e.stop()})),this.mediaStream.value=null;case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"startRecording",value:function(){var e=Object(L["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.recorder.value&&!this.isRecording.value){e.next=2;break}return e.abrupt("return");case 2:if(this.mediaStream.value){e.next=4;break}throw new Error("Webcam must be started before recording can happen");case 4:this.isRecording.value=!0,t=new A.a(this.mediaStream.value,{type:"video"}),t.startRecording(),this.recorder.value=t;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"stopRecording",value:function(){var e=Object(L["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(!t.recorder.value)throw new Error("Haven't started recording");t.isRecording.value=!1;var r=t.recorder.value;t.recorder.value.stopRecording((function(){e(r.getBlob()),t.recorder.value=null}))})));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearRecording",value:function(){var e=Object(L["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.recorder.value=null;case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),q=new _,z=q,F=r("6bd1"),Z=new F["a"]("https://dartrobotlabstorage.blob.core.windows.net/study-video-uploads?sp=acw&st=2022-08-02T21:43:40Z&se=2024-08-03T05:43:40Z&spr=https&sv=2021-06-08&sr=c&sig=SwOP7nqXU21CAeFTS5UDD02uV72QSwuS2aGEdzdxZTc%3D"),J=function(){function e(){Object(D["a"])(this,e)}return Object(M["a"])(e,null,[{key:"upload",value:function(){var e=Object(L["a"])(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Z.getContainerClient("standalone-video-uploads"),a=n.getBlockBlobClient(r),e.next=4,a.uploadData(t);case 4:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}()}]),e}(),G={class:"is-relative webcam-box"},H={ref:"videoE",muted:""},Q={key:0,class:"is-overlay"},X={class:"vcenter-parent"},K={key:0,class:"notification"};function Y(e,t,r,a,c,o){return Object(n["l"])(),Object(n["c"])("div",G,[Object(n["f"])("video",H,null,512),"running"!==e.webcamStatus?(Object(n["l"])(),Object(n["c"])("div",Q,[Object(n["f"])("div",X,[null!==this.webcamStartError?(Object(n["l"])(),Object(n["c"])("div",K,Object(n["p"])(this.webcamStartError),1)):Object(n["d"])("",!0),Object(n["t"])(Object(n["f"])("button",{onClick:t[1]||(t[1]=function(){return e.startWebcam&&e.startWebcam.apply(e,arguments)}),class:["button is-primary",{"is-loading":"loading"===e.webcamStatus}]}," Start Webcam ",2),[[n["r"],"running"!==e.webcamStatus]])])])):Object(n["d"])("",!0)])}var $=Object(n["g"])({name:"WebcamBox",props:{enableRecordButton:{type:Boolean,default:!1}},setup:function(){var e=Object(n["n"])(null),t=Object(n["n"])(null);return Object(n["k"])((function(){if(!e.value)throw new Error("videoE is null");"running"===z.webcamStatus.value&&z.connectVideoElement(e.value)})),Object(n["s"])(z.webcamStatus,(function(t){"running"===t&&e.value&&z.connectVideoElement(e.value)})),Object(n["j"])((function(){if(!e.value)throw new Error("videoE is null");z.disconnectVideoElement(e.value)})),{videoE:e,webcamStartError:t,webcamProvider:z,webcamStatus:z.webcamStatus,isRecording:z.isRecording}},methods:{startWebcam:function(){var e=this;return Object(L["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.webcamStartError=null,t.prev=1,t.next=4,z.startWebcam();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](1),e.webcamStartError=t.t0;case 9:if(e.videoE){t.next=11;break}throw new Error("videoE is null");case 11:return t.next=13,z.connectVideoElement(e.videoE);case 13:case"end":return t.stop()}}),t,null,[[1,6]])})))()},playVideo:function(){if(!this.videoE)throw new Error("videoE is null");this.videoE.play()}}});r("c118");$.render=Y;var ee=$,te=Object(n["g"])({name:"UploadScreen",components:{WebcamBox:ee},setup:function(){var e=Object(n["n"])("Record"),t=Object(n["n"])(null),r=Object(n["n"])(""),a=Object(n["n"])(!1),c=Object(n["n"])(null);return{state:e,dataStore:s,webcamProvider:z,webcamStatus:z.webcamStatus,isRecording:z.isRecording,lastRecordedBlob:t,recordedObjectUrl:r,isUploading:a,uploadError:c}},methods:{toggleRecording:function(){var e=this;return Object(L["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(z.isRecording.value){t.next=7;break}return t.next=3,z.startWebcam();case 3:return t.next=5,z.startRecording();case 5:t.next=14;break;case 7:return t.next=9,z.stopRecording();case 9:return e.lastRecordedBlob=t.sent,e.recordedObjectUrl=URL.createObjectURL(e.lastRecordedBlob),e.state="Review",t.next=14,z.stopWebcam();case 14:case"end":return t.stop()}}),t)})))()},rerecord:function(){var e=this;return Object(L["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.lastRecordedBlob=null,e.recordedObjectUrl="",e.uploadError=null,e.state="Record",t.next=6,z.startWebcam();case 6:case"end":return t.stop()}}),t)})))()},uploadVideo:function(){var e=this;return Object(L["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.lastRecordedBlob){t.next=2;break}return t.abrupt("return");case 2:if(!e.isUploading){t.next=4;break}return t.abrupt("return");case 4:return e.isUploading=!0,e.uploadError=null,r="".concat(s.experimentName,"-").concat(s.participantId,"-").concat(s.uploadName,".webm"),t.prev=7,t.next=10,J.upload(e.lastRecordedBlob,r);case 10:t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](7),console.error("Error uploading video",t.t0),e.uploadError=t.t0;case 16:null===e.uploadError&&(e.uploadError="Upload Successful"),e.isUploading=!1;case 18:case"end":return t.stop()}}),t,null,[[7,12]])})))()}}});r("707e");te.render=I;var re=te,ne=Object(n["g"])({name:"App",components:{UploadScreen:re}});ne.render=l;var ae=ne,ce=r("9483");Object(ce["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),a["c"].add(c["a"]),r("b383"),Object(n["b"])(ae).component("FAIcon",o["a"]).mount("#app"),Object(n["i"])(u)}});
//# sourceMappingURL=app.4e141dbf.js.map